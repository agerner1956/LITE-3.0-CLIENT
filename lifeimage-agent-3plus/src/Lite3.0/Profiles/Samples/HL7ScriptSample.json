{
  "name": "HL7 Script Samples",
  "connections": [
    {
      "name": "hl7in",
      "enabled": true,
      "connType": "hl7",
      "localHostname": "localhost",
      "localPort": 2575,
      "receiveBufferSize": 256000,
      "exclusiveAddressUse": true,
      "linger": false,
      "lingerms": 10,
      "noDelay": false,
      "receiveTimeout": 0,
      "sendBufferSize": 256000,
      "sendTimeout": 0,
      "ackMode": "Custom",
      "ack": "ACK",
      "maxHL7InboundTasks": 1,
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 30,
      "maxConnectionsPerServer": 10,
      "bufferSize": 4096,
      "inout": "inbound"
    },
    {
      "name": "DCMRECV",
      "enabled": true,
      "connType": "dicom",
      "remoteHostname": "Stephens-MacBook-Pro.local",
      "remotePort": 11112,
      "localAETitle": "LITEDCMRECV",
      "remoteAETitle": "DCMRECV",
      "localHostname": "Stephens-MacBook-Pro.local",
      "localPort": 11113,
      "useTLS": false,
      "currentRequests": 0,
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 10,
      "bufferSize": 4096,
      "inout": "outbound"
    },
    {
      "name": "DCMSEND",
      "enabled": true,
      "connType": "dicom",
      "remoteHostname": "Stephens-MacBook-Pro.local",
      "remotePort": 11114,
      "localAETitle": "LITEDCMSEND",
      "remoteAETitle": "DCMSEND",
      "localHostname": "Stephens-MacBook-Pro.local",
      "localPort": 11115,
      "useTLS": false,
      "currentRequests": 0,
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 10,
      "bufferSize": 4096,
      "inout": "inbound"
    },
    {
      "name": "Archive",
      "enabled": true,
      "connType": "file",
      "remotePort": 0,
      "inpath": "/tmp/lifeimage/Archive",
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 10,
      "bufferSize": 4096,
      "inout": "inbound"
    },
    {
      "name": "TmpFolder2",
      "enabled": true,
      "connType": "file",
      "remotePort": 0,
      "inpath": "/tmp/lifeimage/tmpfolder2",
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 10,
      "bufferSize": 4096,
      "inout": "inbound"
    },
    {
      "name": "bourne1",
      "enabled": true,
      "connType": "cloud",
      "remotePort": 0,
      "shareDestinations": [
        {
          "boxId": "103",
          "groupId": "124",
          "groupName": "bourne2pc",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bourne2",
          "boxName": "bourne2pc",
          "boxUuid": "ad0fb00b-a619-4e83-a216-dfc0bb02a355"
        },
        {
          "boxId": "104",
          "groupId": "127",
          "groupName": "bourne3pc",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bourne3",
          "boxName": "bourne3pc",
          "boxUuid": "19db62ba-128d-412c-8c4f-df28351e8ae0"
        }
      ],
      "markDownloadsComplete": [],
      "markSeriesComplete": [],
      "studies": {
        "ImagingStudy": []
      },
      "isPrimary": true,
      "URL": "http://cloud-pr-dev1.lifeimage.lan:8080/universal-inbox",
      "organizationCode": "bourne1",
      "maxStudyDownloadTasks": 5,
      "maxWadoTasks": 1,
      "maxStowTasks": 5,
      "serviceName": "bourne1pc",
      "subscriptionCode": "8faaf720-b748-4da6-b782-bbb720edeb81",
      "tenantID": "02c99a42-e427-4b7b-a5b0-da8081289530",
      "scanpaths": [],
      "studySeriesSOPUids": [],
      "username": "bourne1agent@example.com",
      "Password": "B7CUmEc8RvGOQ+I2qCWDrQ==",
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 60,
      "bufferSize": 4096,
      "inout": "both"
    },
    {
      "name": "bourne2",
      "enabled": true,
      "connType": "cloud",
      "remotePort": 0,
      "shareDestinations": [
        {
          "boxId": "101",
          "groupId": "119",
          "groupName": "bourne1pc",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bourne1",
          "boxName": "bourne1pc",
          "boxUuid": "bce733c0-f044-425c-b43f-409e924c4300"
        },
        {
          "boxId": "104",
          "groupId": "127",
          "groupName": "bourne3pc",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bourne3",
          "boxName": "bourne3pc",
          "boxUuid": "19db62ba-128d-412c-8c4f-df28351e8ae0"
        }
      ],
      "markDownloadsComplete": [],
      "markSeriesComplete": [],
      "studies": {
        "ImagingStudy": []
      },
      "isPrimary": false,
      "URL": "http://cloud-pr-dev1.lifeimage.lan:8080/universal-inbox",
      "organizationCode": "bourne2",
      "maxStudyDownloadTasks": 5,
      "maxWadoTasks": 1,
      "maxStowTasks": 5,
      "serviceName": "bourne2pc",
      "subscriptionCode": "57a659cb-750d-44cd-877b-eb77ab099898",
      "tenantID": "0507ff5a-b372-473c-b151-324e6113d0af",
      "scanpaths": [],
      "studySeriesSOPUids": [],
      "username": "bourne2agent@example.com",
      "Password": "Y/ZPhyIUJKXaA94Mf5KsCQ==",
      "sharedKey": "TbT3icwF25bJJRB5oxzwUedRD6uLdA+37wzrNfBfbRE=",
      "IV": "XrfeJFbhbvPaZnZVTcmbkA==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 60,
      "bufferSize": 4096,
      "inout": "both"
    },
    {
      "name": "bourne3",
      "enabled": true,
      "connType": "cloud",
      "remotePort": 0,
      "shareDestinations": [
        {
          "boxId": "101",
          "groupId": "119",
          "groupName": "bourne1pc",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bourne1",
          "boxName": "bourne1pc",
          "boxUuid": "bce733c0-f044-425c-b43f-409e924c4300"
        },
        {
          "boxId": "103",
          "groupId": "124",
          "groupName": "bourne2pc",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bourne2",
          "boxName": "bourne2pc",
          "boxUuid": "ad0fb00b-a619-4e83-a216-dfc0bb02a355"
        },
        {
          "boxId": "203",
          "groupId": "289",
          "groupName": "bqa7grp",
          "publishableBoxType": "CONNECTION",
          "organizationName": "bqa7",
          "boxName": "bqa7pc",
          "boxUuid": "1e9d81bf-0682-431e-b30a-760e5141aecc"
        }
      ],
      "markDownloadsComplete": [],
      "markSeriesComplete": [],
      "studies": {
        "ImagingStudy": []
      },
      "isPrimary": false,
      "URL": "http://cloud-pr-dev1.lifeimage.lan:8080/universal-inbox",
      "organizationCode": "bourne3",
      "maxStudyDownloadTasks": 5,
      "maxWadoTasks": 1,
      "maxStowTasks": 5,
      "serviceName": "bourne3pc",
      "subscriptionCode": "6f88c530-407c-438a-befe-c9fa34ae1a10",
      "tenantID": "0a282254-779b-4bb3-afd6-d0bf3a35cd53",
      "scanpaths": [],
      "studySeriesSOPUids": [],
      "username": "bourne3agent@example.com",
      "Password": "Y/ZPhyIUJKXaA94Mf5KsCQ==",
      "sharedKey": "TbT3icwF25bJJRB5oxzwUedRD6uLdA+37wzrNfBfbRE=",
      "IV": "XrfeJFbhbvPaZnZVTcmbkA==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 60,
      "bufferSize": 4096,
      "inout": "both"
    },
    {
      "name": "TmpFolder",
      "enabled": true,
      "connType": "file",
      "remotePort": 0,
      "inpath": "/tmp/lifeimage/tmpfolder",
      "sharedKey": "suqpy/JFp7WSYm5Ij0P4FqpVAofCTh3Zj8ELuDhkXjw=",
      "IV": "ort0hcZC0NOtUoPlUQuVpQ==",
      "maxInboundConnections": 3,
      "maxConnectionsPerServer": 10,
      "bufferSize": 4096,
      "inout": "inbound"
    }
  ],
  "rules": {
    "destRules": [
      {
        "name": "HL7tobourne1or2",
        "enabled": true,
        "fromConnectionName": "hl7in",
        "toConnections": [
          {
            "connectionName": "bourne1",
            "shareDestinations": null
          },
          {
            "connectionName": "bourne2",
            "shareDestinations": null
          }
        ],
        "ruleTags": [],
        "modality": null,
        "preProcessFromConnectionScriptNames": [],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [
          "HL7 Report Status"
        ],
        "postProcessToConnectionScriptNames": []
      },
      {
        "name": "DCMSENDTobourne1",
        "enabled": true,
        "fromConnectionName": "DCMSEND",
        "toConnections": [
          {
            "connectionName": "bourne1",
            "shareDestinations": null
          },
          {
            "connectionName": "Archive",
            "shareDestinations": null
          }
        ],
        "ruleTags": [
          {
            "tag": "0008,0020",
            "tagValue": ".+",
            "scriptName": "After 1980"
          },
          {
            "tag": "0008,0020",
            "tagValue": ".+",
            "scriptName": "Prior Rolling 12 Months"
          },
          {
            "tag": "0008,0020",
            "tagValue": ".+",
            "scriptName": "7 Days Old"
          }
        ],
        "modality": null,
        "preProcessFromConnectionScriptNames": [],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [
          "ruleTags"
        ],
        "postProcessToConnectionScriptNames": []
      },
      {
        "name": "bourne1toDCMRECV",
        "enabled": true,
        "fromConnectionName": "DCMRECV",
        "toConnections": [
          {
            "connectionName": "DCMRECV",
            "shareDestinations": null
          }
        ],
        "ruleTags": [],
        "modality": null,
        "preProcessFromConnectionScriptNames": [
          "ruleTags"
        ],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [],
        "postProcessToConnectionScriptNames": []
      },
      {
        "name": "bourne2toTmpFolder",
        "enabled": true,
        "fromConnectionName": "bourne2",
        "toConnections": [
          {
            "connectionName": "TmpFolder",
            "shareDestinations": null
          }
        ],
        "ruleTags": [],
        "modality": null,
        "preProcessFromConnectionScriptNames": [
          "ruleTags"
        ],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [],
        "postProcessToConnectionScriptNames": []
      },
      {
        "name": "DCMSENDtobourne2",
        "enabled": true,
        "fromConnectionName": "DCMSEND",
        "toConnections": [
          {
            "connectionName": "bourne2",
            "shareDestinations": null
          }
        ],
        "ruleTags": [],
        "modality": null,
        "preProcessFromConnectionScriptNames": [
          "ruleTags"
        ],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [],
        "postProcessToConnectionScriptNames": []
      },
      {
        "name": "bourne3toDCMRECV",
        "enabled": true,
        "fromConnectionName": "DCMRECV",
        "toConnections": [
          {
            "connectionName": "DCMRECV",
            "shareDestinations": null
          }
        ],
        "ruleTags": [],
        "modality": null,
        "preProcessFromConnectionScriptNames": [
          "ruleTags"
        ],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [],
        "postProcessToConnectionScriptNames": []
      },
      {
        "name": "DCMSENDtobourne3",
        "enabled": true,
        "fromConnectionName": "DCMSEND",
        "toConnections": [
          {
            "connectionName": "bourne3",
            "shareDestinations": null
          }
        ],
        "ruleTags": [],
        "modality": null,
        "preProcessFromConnectionScriptNames": [
          "ruleTags"
        ],
        "postProcessFromConnectionScriptNames": [],
        "preProcessToConnectionScriptNames": [],
        "postProcessToConnectionScriptNames": []
      }
    ],
    "scripts": [
      {
        "name": "HL7 Report Status",
        "source": "using Dicom;\nusing System;\nusing System.Diagnostics;\nusing System.IO;\nusing System.Linq;\nusing Dicom;\nusing System.Globalization;\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{stream}\");\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"HL7 Report Status: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\nStreamReader reader = new StreamReader( stream );\nstring text = reader.ReadToEnd();\n if(text.Contains(\"FINALREPORT\")) {if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"HL7 Report Status: Sending to bourne1\");\ntoConnections.RemoveAll(e => e.connectionName != \"bourne1\");\n}else{if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"HL7 Report Status: Sending to bourne2\");\ntoConnections.RemoveAll(e => e.connectionName != \"bourne2\");\n}if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"HL7 Report Status: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n",
        "imports": [
          "System",
          "System.Linq, System.Core",
          "Dicom.DicomTag, Dicom"
        ],
        "references": [
          "System.Object",
          "System.Linq.Enumerable, System.Core",
          "Dicom.DicomTag, Dicom.Core"
        ],
        "errors": "No Errors.  Last executed at 2017-12-22 16:21:58.6684"
      },
      {
        "name": "7 Days Old",
        "source": "using Dicom;\nusing System;\nusing System.Diagnostics;\nusing System.Linq;\nusing Dicom;\nusing System.Globalization;\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{ruleDicomTag.tag}{ruleDicomTag.tagValue}\");\nCultureInfo culture;\nDateTimeStyles styles;\nDateTime studyDate;\nDicomTag dtTag = Dicom.DicomTag.Parse(ruleDicomTag.tag);\nstring tagValue = sourceDicomFile.Dataset.Get<string>(dtTag);\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{tagValue}\");\nculture = CultureInfo.CreateSpecificCulture(\"en-US\");\nstyles = DateTimeStyles.AssumeLocal;\nstudyDate = DateTime.ParseExact(tagValue,\"yyyyMMdd\",culture, styles);\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"7 Days Old: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n if(DateTime.Now.AddDays(-7).CompareTo(studyDate) <= 0) {if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"7 Days Old: {studyDate} Sending to bourn1\");\ntoConnections.RemoveAll(e => e.connectionName == \"bourne1\");\n}else{if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"7 Days Old: {studyDate} Sending to bourne2\");\ntoConnections.RemoveAll(e => e.connectionName != \"bourne2\");\n}if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"7 Days Old: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n",
        "imports": [
          "System",
          "System.Linq, System.Core",
          "Dicom.DicomTag, Dicom"
        ],
        "references": [
          "System.Object",
          "System.Linq.Enumerable, System.Core",
          "Dicom.DicomTag, Dicom.Core"
        ],
        "errors": "No Errors.  Last executed at 2017-12-22 10:03:01.7345"
      },
      {
        "name": "After 1980",
        "source": "using Dicom;\nusing System;\nusing System.Diagnostics;\nusing System.Linq;\nusing Dicom;\nusing System.Globalization;\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{ruleDicomTag.tag}{ruleDicomTag.tagValue}\");\nCultureInfo culture;\nDateTimeStyles styles;\nDateTime studyDate;\nDicomTag dtTag = Dicom.DicomTag.Parse(ruleDicomTag.tag);\nstring tagValue = sourceDicomFile.Dataset.Get<string>(dtTag);\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{tagValue}\");\nculture = CultureInfo.CreateSpecificCulture(\"en-US\");\nstyles = DateTimeStyles.AssumeLocal;\nstudyDate = DateTime.ParseExact(tagValue,\"yyyyMMdd\",culture, styles);\n if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"After 1980: {studyDate}\");\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"After 1980: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n if(DateTime.Parse(\"01-01-1980\").CompareTo(studyDate) <= 0) {if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"After 1980: Sending to regular routes\");\ntoConnections.RemoveAll(e => e.connectionName == \"Archive\");\n}else{if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"After 1980: Sending to Archive\");\ntoConnections.RemoveAll(e => e.connectionName != \"Archive\");\n}if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"After 1980: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n",
        "imports": [
          "System",
          "System.Linq, System.Core",
          "Dicom.DicomTag, Dicom"
        ],
        "references": [
          "System.Object",
          "System.Linq.Enumerable, System.Core",
          "Dicom.DicomTag, Dicom.Core"
        ],
        "errors": "No Errors.  Last executed at 2017-12-22 10:03:01.7265"
      },
      {
        "name": "Prior Rolling 12 Months",
        "source": "using Dicom;\nusing System;\nusing System.Diagnostics;\nusing System.Linq;\nusing Dicom;\nusing System.Globalization;\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{ruleDicomTag.tag}{ruleDicomTag.tagValue}\");\nCultureInfo culture;\nDateTimeStyles styles;\nDateTime studyDate;\nDicomTag dtTag = Dicom.DicomTag.Parse(ruleDicomTag.tag);\nstring tagValue = sourceDicomFile.Dataset.Get<string>(dtTag);\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"{tagValue}\");\nculture = CultureInfo.CreateSpecificCulture(\"en-US\");\nstyles = DateTimeStyles.AssumeLocal;\nstudyDate = DateTime.ParseExact(tagValue,\"yyyyMMdd\",culture, styles);\n if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"Prior Rolling 12 Months: {studyDate}\");\nif (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"Prior Rolling 12 Months: Connections: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n if(studyDate.CompareTo(DateTime.Now.AddYears(-1)) <= 0 && studyDate.CompareTo(DateTime.Now.AddYears(-2)) >= 0){if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"Prior Rolling 12 Months: Sending to retrospective\");\ntoConnections.RemoveAll(e => e.connectionName != \"bourne3\");\n}else{if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"Prior Rolling 12 Months: Not a retrospective \");\ntoConnections.RemoveAll(e => e.connectionName == \"bourne3\");\n}if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, $\"Prior Rolling 12 Months: {string.Join(\",\", toConnections.Select(x=>x.connectionName))} \");\n",
        "imports": [
          "System",
          "System.Linq, System.Core",
          "Dicom.DicomTag, Dicom"
        ],
        "references": [
          "System.Object",
          "System.Linq.Enumerable, System.Core",
          "Dicom.DicomTag, Dicom.Core"
        ],
        "errors": "No Errors.  Last executed at 2017-12-22 10:03:01.7304"
      },
      {
        "name": "Hello World",
        "source": "System.if (logger.FileTraceLevel == \"Trace\") logger.Log(TraceEventType.Verbose, \"Hello World!\");\n",
        "imports": [
          ""
        ],
        "references": [
          "System.Object"
        ],
        "errors": null
      }
    ]
  },
  "logRetentionDays": 1,
  "tempFileRetentionHours": 1,
  "version": 300,
  "highWait": false,
  "highWaitDelay": 60000,
  "mediumWait": false,
  "mediumWaitDelay": 30000,
  "enabled": true,
  "activationTime": "0001-01-01T00:00:00",
  "errors": [],
  "tempPath": "/tmp/lifeimage",
  "run": [],
  "recoveryInterval": 120000,
  "lastStartup": "2017-12-22T14:50:29.753179-05:00",
  "lastKickOff": "2017-12-22T16:23:59.164651-05:00",
  "startupParams": {
    "localProfilePath": "Profiles/HL7ScriptSamples.json",
    "saveProfilePath": "Profiles/HL7ScriptSamples.json",
    "getServerProfile": true,
    "putServerProfile": true,
    "generateSchema": false,
    "validateProfile": true
  },
  "logger": {
    "ConsoleTraceLevel": "Warning",
    "FileTraceLevel": "Verbose",
    "SplunkTraceLevel": "Info",
    "TracePattern": null
  },
  "runningCodeVersion": "1.0.69.0",
  "updatePassword": {}
}